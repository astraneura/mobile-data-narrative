<!DOCTYPE html>
<html>
    <head>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
        <meta name='viewport' content='width=device-width, initial-scale=1' />
        <script src="https://kit.fontawesome.com/91bf4ff74d.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="style.css">
        <script src="https://d3js.org/d3.v6.js"></script>
        <script> src="dataVisualization.js"</script>
        <title>Villagers And Personalities </title>
    </head>
    <body>
        <!-- Navigation Bar -->
        <nav class="navbar navbar-expand-lg">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Nook's Insights</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="narrative.html">Narrative</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="resetting.html">Resetting</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active icon-leaf" aria-current="page" href="villagers.html">Favorite Villagers</a>
                            
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
<div class = "villagers-body">
    <div class="container-fluid">
        <div class="row">
            <div class ="col-6">
                <h1>Villager Personalities in Animal Crossing</h1>
                <p>Villagers in the Animal Crossing series all belong to one of 8 personality types: Lazy, Normal/Sweet, Peppy, Jock, Cranky, Snooty, Smug, or Sisterly.</p>
                <p>Each personality type is also gender specific: Lazy, Jock, Cranky, and Smug are male exclusive, while Normal/Sweet, Peppy, Snooty, and Sisterly are female exclusive.</p>
                <p>The different personality types all have different interactions and dialogues with the player, and will give the player different emotion reactions over the course of the game.</p>
                <p>Some players prefer certain personality types over others, and some have favorite villagers that they always want to have on their island.</p>
                <p>The two favorite types were the Normal/Sweet and Lazy types, with 25 votes and 24 votes respectively. Jock and Smug were the least popular favorite types, each with 3 votes.</p>
                <p>The visualization below shows the connections between a respondent's favorite villager and their favorite type, with arcs connecting those together, and can be sorted by alphabetical order, or by personality type.</p>
            </div>
            <div class="col-6">
                <div  class="centered">
                    <img src="images/dialogues.png" id="dialogueImage" alt="Various Dialogues" class="img-fluid">
                </div>
            </div>
        </div>
        <div class="dataVis">
            <h1> Connections Between Favorite Personality Types and Favorite Villager </h1>
            <select id="sort-order">
                <option value="by name">By Name</option>
                <option value="by personality">By Personality</option>
            </select>
        </div>
    <div class = "row">
        <div class="col-12">
            <h1>Player "Loyalty" to Personality Types and Villagers</h1>
            <p>The data shows that overwhelmingly, a player's favorite villager doesn't match their favorite personality type.</p>
            <p>There were only two personality types where players also preferred a villager of that type: lazy, with 14 of the 24 votes, and jock, with 2 of the 3 votes.</p>
            <p>The personalities with the least "loyalty", to put it, were snooty and smug, where only one player with that favorite type also had a favorite villager that matched that personality type.</p>
        </div>
    </div>
    <div class="row">
        <div class="col-3"></div>
        <div class="col-6">
            <h1> Villager and Personality Type Matches </h1>
            <div id="my_dataviz"></div>
        </div>
        <div class="col-3"></div>
</div>
<div class = "row">
    <div class="col-12">
        <h1> Personality Match Conclusions</h1>
        <p>Overall, if your favorite personality type is lazy or jock, your favorite villager would likely share that type.</p>
        <p>If your favorite personality type was any of the others, it'd be likely that your favorite villager would have a different personality.</p>
    </div>
</div>
</div>
<div>
    <i class="fa-solid fa-plane" id="airplane"></i>
</div>
</div>
</body>
<script>
    const data = {
      "personalityPreferences": [
        "Normal/Sweet", "Cranky", "Lazy", "Peppy", "Lazy", "Normal/Sweet", "Lazy", 
        "Normal/Sweet", "Cranky", "Peppy", "Normal/Sweet", "Normal/Sweet", "Normal/Sweet", 
        "Lazy", "Snooty", "Snooty", "Cranky", "Cranky", "Cranky", "Cranky", "Cranky", 
        "Lazy", "Normal/Sweet", "Normal/Sweet", "Lazy", "Peppy", "Lazy", "Lazy", 
        "Normal/Sweet", "Cranky", "Cranky", "Sisterly", "Normal/Sweet", "Smug", 
        "Cranky", "Normal/Sweet", "Normal/Sweet", "Normal/Sweet", "Lazy", "Snooty", 
        "Lazy", "Sisterly", "Cranky", "Cranky", "Sisterly", "Peppy", "Lazy", "Lazy", 
        "Sisterly", "Normal/Sweet", "Normal/Sweet", "Lazy", "Normal/Sweet", "Peppy", 
        "Normal/Sweet", "Normal/Sweet", "Normal/Sweet", "Lazy", "Cranky", "Sisterly", 
        "Lazy", "Cranky", "Jock", "Normal/Sweet", "Cranky", "Sisterly", "Smug", 
        "Normal/Sweet", "Jock", "Snooty", "Cranky", "Normal/Sweet", "Lazy", "Jock", 
        "Peppy", "Lazy", "Lazy", "Sisterly", "Normal/Sweet", "Cranky", "Lazy", 
        "Normal/Sweet", "Lazy", "Normal/Sweet", "Sisterly", "Cranky", "Lazy", 
        "Sisterly", "Peppy", "Cranky", "Lazy", "Smug", "Peppy", "Lazy", "Lazy", 
        "Sisterly"
      ],
      "favorite_villager" : [
            "Axel",
            "Buzz",
            "Cole",
            "Lily",
            "Benjamin",
            "Katt",
            "Apple",
            "Muffy",
            "Gaston",
            "Punchy",
            "Daisy",
            "Eunice",
            "Phil",
            "Wolfgang",
            "Octavian",
            "Chrissy",
            "Dobie",
            "Groucho",
            "Apollo",
            "Walt",
            "Merry",
            "Stitches",
            "Shino",
            "Papi",
            "Fauna",
            "Flora",
            "Dobie",
            "Francine",
            "Pietro",
            "Antonio",
            "Ione",
            "Lobo",
            "Moe",
            "Melba",
            "Lolly",
            "Marina",
            "Stella",
            "Whitney",
            "Lucky",
            "Pietro",
            "Bob",
            "Poppy",
            "Bea",
            "Daisy",
            "Phoebe",
            "Sherb",
            "Stitches",
            "Deirdre",
            "Carmen",
            "Shino",
            "Filbert",
            "Punchy",
            "Rosie",
            "Coco",
            "Nan",
            "Peanut",
            "Genji",
            "Elvis",
            "Stitches",
            "Sherb",
            "Biskit",
            "Aurora",
            "Maple",
            "Monique",
            "Raymond",
            "Raymond",
            "Zucker",
            "Peck",
            "Ava",
            "Cally",
            "Hugh",
            "Rudy",
            "Anabelle",
            "Diana",
            "Sherb",
            "Joey",
            "Tia",
            "Ozzie",
            "Goldie",
            "Monique",
            "Sherb",
            "Roald",
            "Katt",
            "Moe",
            "Molly",
            "Agnes",
            "Lolly",
            "Monique",
            "Hugh",
            "Ruby",
            "Dom",
            "Pattie",
            "Drift",
            "Diva"
        ]
    };
    const nodes = [];
    const links = [];
    
    data.favorite_villager.forEach((villager, index) => {
        const personality = data.personalityPreferences[index];
    
        if (!nodes.find(n => n.id === villager)){
            nodes.push({ id: villager, group: 1});
        }
        if (!nodes.find (n => n.id === personality)){
        nodes.push({ id: personality, group: 2});        
        }
        links.push({ source: villager, target: personality });
    });
    
    // Define an order for sorting nodes (by name in this case)
    const orders = new Map([
        ["by name", nodes.map(d => d.id).sort(d3.ascending)],
        ["by personality", nodes
            .filter(d => d.group === 2).map(d => d.id)
            .concat(nodes.filter(d => d.group === 1).map(d => d.id))]
    ]);
    
    
    const width = 740;
    const step = 14;
    const marginTop = 20;
    const marginRight = 20;
    const marginBottom = 20;
    const marginLeft = 130;
    
    const chart = () => {
        const height = (nodes.length - 1) * step + marginTop + marginBottom;
        const y = d3.scalePoint(orders.get("by name"), [marginTop, height - marginBottom]);
    
        // A color scale for the nodes and links.
        const color = d3.scaleOrdinal()
            .domain(nodes.map(d => d.group).sort(d3.ascending))
            .range(d3.schemeCategory10)
            .unknown("#aaa");
    
        const groups = new Map(nodes.map(d => [d.id, d.group]));
    
        function samegroup({ source, target }) {
            return groups.get(source) === groups.get(target) ? groups.get(source) : null;
        }
    
        const svg = d3.create("svg")
            .attr("width", width)
            .attr("height", height)
            .attr("viewBox", [0, 0, width, height])
            .attr("style", "max-width: 100%; height: auto;");
    
        const Y = new Map(nodes.map(({ id }) => [id, y(id)]));
    
        function arc(d) {
            const y1 = Y.get(d.source);
            const y2 = Y.get(d.target);
            const r = Math.abs(y2 - y1) / 2;
            return `M${marginLeft},${y1}A${r},${r} 0,0,${y1 < y2 ? 1 : 0} ${marginLeft},${y2}`;
        }
    
        const path = svg.insert("g", "*")
            .attr("fill", "none")
            .attr("stroke-opacity", 0.6)
            .attr("stroke-width", 1.5)
            .selectAll("path")
            .data(links)
            .join("path")
            .attr("stroke", d => color(samegroup(d)))
            .attr("d", arc);
    
        const label = svg.append("g")
            .attr("font-family", "sans-serif")
            .attr("font-size", 10)
            .attr("text-anchor", "end")
            .selectAll("g")
            .data(nodes)
            .join("g")
            .attr("transform", d => `translate(${marginLeft},${Y.get(d.id)})`)
            .call(g => g.append("text")
                .attr("x", -6)
                .attr("dy", "0.35em")
                .attr("fill", d => d3.lab(color(d.group)).darker(2))
                .text(d => d.id))
            .call(g => g.append("circle")
                .attr("r", 3)
                .attr("fill", d => color(d.group)));
    
        label.append("rect")
            .attr("fill", "none")
            .attr("width", marginLeft + 40)
            .attr("height", step)
            .attr("x", -marginLeft)
            .attr("y", -step / 2)
            .attr("pointer-events", "all")
            .on("pointerenter", (event, d) => {
                svg.classed("hover", true);
                label.classed("primary", n => n === d);
                label.classed("secondary", n => links.some(({ source, target }) => (
                    n.id === source && d.id == target || n.id === target && d.id === source
                )));
                path.classed("primary", l => l.source === d.id || l.target === d.id).filter(".primary").raise();
            })
            .on("pointerout", () => {
                svg.classed("hover", false);
                label.classed("primary", false);
                label.classed("secondary", false);
                path.classed("primary", false).order();
            });
    
        svg.append("style").text(`
            .hover text { fill: #aaa; }
            .hover g.primary text { font-weight: bold; fill: #333; }
            .hover g.secondary text { fill: #333; }
            .hover path { stroke: #ccc; }
            .hover path.primary { stroke: #333; }
        `);
    
        function update(order) {
            y.domain(order);
    
            label
                .sort((a, b) => d3.ascending(Y.get(a.id), Y.get(b.id)))
                .transition()
                .duration(750)
                .delay((d, i) => i * 20)
                .attrTween("transform", d => {
                    const i = d3.interpolateNumber(Y.get(d.id), y(d.id));
                    return t => {
                        const y = i(t);
                        Y.set(d.id, y);
                        return `translate(${marginLeft},${y})`;
                    };
                });
    
            path.transition()
                .duration(750 + nodes.length * 20)
                .attrTween("d", d => () => arc(d));
        }
    
        return Object.assign(svg.node(), { update });
    };
    
    const myChart = chart();
    document.querySelector(".dataVis").appendChild(myChart);
    
    document.getElementById("sort-order").addEventListener("change", (event) => {
            const selectedOrder = orders.get(event.target.value);
            if (selectedOrder) {
                myChart.update(selectedOrder);
            }
        });
</script>
<script>
    function treeMapGraph(){
          // Set the dimensions and margins of the graph
  const margin = {top: 10, bottom: 10, left: 0, right: 0},
    width = 800,
    height = 600 - margin.top - margin.bottom;

  // Append the svg object to the body of the page
  const svg = d3.select("#my_dataviz")
    .append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
    .append("g")
      .attr("transform", `translate(${margin.left}, ${margin.top})`);

    
    const graphData = [
    "normal + match", "normal + match","normal + match","normal + match","normal + match","normal + match","normal + match",
    "normal + match","normal + match","normal + no match","normal + no match","normal + no match","normal + no match","normal + no match",
    "normal + no match","normal + no match","normal + no match","normal + no match","normal + no match","normal + no match","normal + no match",
    "normal + no match","normal + no match","normal + no match","normal + no match","sisterly + match","sisterly + match","sisterly + match",
    "sisterly + match","sisterly + no match","sisterly + no match","sisterly + no match","sisterly + no match","sisterly + no match","sisterly + no match",
    "lazy + match","lazy + match","lazy + match","lazy + match","lazy + match","lazy + match","lazy + match","lazy + match","lazy + match","lazy + match",
    "lazy + match","lazy + match","lazy + match","lazy + match","lazy + no match","lazy + no match","lazy + no match","lazy + no match","lazy + no match",
    "lazy + no match","lazy + no match","lazy + no match","lazy + no match","lazy + no match","peppy + match","peppy + match","peppy + match","peppy + no match",
    "peppy + no match","peppy + no match","peppy + no match","peppy + no match","smug + match","smug + no match","smug + no match","cranky + match",
    "cranky + match","cranky + match","cranky + match","cranky + match","cranky + match","cranky + match","cranky + match","cranky + match",
    "cranky + no match","cranky + no match","cranky + no match","cranky + no match","cranky + no match","cranky + no match","cranky + no match",
    "cranky + no match","cranky + no match","cranky + no match","snooty + match","snooty + no match","snooty + no match","snooty + no match",
    "jock + match", "jock + match", "jock + no match" 
  ];

  const matchCounts = {};
  graphData.forEach(match => {
    matchCounts[match] = (matchCounts[match] || 0) + 1;
  });

  const root = d3.hierarchy({
    children: Object.entries(matchCounts).map(([name, value]) => ({ name, value }))
  }).sum(d => d.value);

  d3.treemap()
    .size([width, height])
    .padding(4)
    (root);

  // Add rectangles for each node
  svg
    .selectAll("rect")
    .data(root.leaves())
    .join("rect")
      .attr('x', d => d.x0)
      .attr('y', d => d.y0)
      .attr('width', d => d.x1 - d.x0)
      .attr('height', d => d.y1 - d.y0)
      .style("stroke", "black")
      .style("fill", d => determineColor(d.data.name));

  function determineColor(name) {
  if (name.includes("no match")) {
    return "lightcoral"; // Light red for "no match"
  } else if (name.includes("match")) {
    return "lightgreen"; // Light green for "match"
  }
  return "lightgray"; // Default color if neither condition matches
}

  // Add text labels for each node, hidden by default
  const textLabels = svg
    .selectAll("text")
    .data(root.leaves())
    .join("text")
      .attr("x", d => d.x0 + (d.x1 - d.x0) / 2) // Center text horizontally
      .attr("y", d => d.y0 + (d.y1 - d.y0) / 2) // Center text vertically
      .text(d => `${d.data.name}: ${d.data.value}`)
      .attr("font-size", d => calculateFontSize(d))
      .attr("fill", "black")
      .attr("font-family", "Patrick Hand")
      .attr("text-anchor", "middle")
      .attr("dominant-baseline", "middle")
      .style("pointer-events", "none")
      .style("opacity", 0); // Hidden initially

  // Function to calculate font size based on rectangle size
  function calculateFontSize(d) {
    const width = d.x1 - d.x0;
    const height = d.y1 - d.y0;
    const text = `${d.data.name}: ${d.data.value}`;
    const textLength = text.length;

    // Scale factor ensures text fits both horizontally and vertically
    const widthFactor = width / (textLength * 6); // Approx. 6px per character width
    const heightFactor = height / 12; // Approx. 12px for a line of text
    const scaleFactor = Math.min(widthFactor, heightFactor);

    return Math.max(10, Math.floor(scaleFactor * 10)) + "px";
  }

  // Add hover functionality to show/hide text
  svg.selectAll("rect")
    .on("mouseover", function(event, d) {
      d3.select(textLabels.nodes()[root.leaves().indexOf(d)])
        .style("opacity", 1);
    })
    .on("mouseout", function(event, d) {
      d3.select(textLabels.nodes()[root.leaves().indexOf(d)])
        .style("opacity", 0);
    });
    }

window.addEventListener('load', treeMapGraph());
</script>
</html>